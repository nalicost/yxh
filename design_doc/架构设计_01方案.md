# 基于生成式ai的交通模拟辅助决策系统架构设计1. 目标设计    * 完成可以基于生成式ai，并通过初始参数的输入，得到完整模拟结果，以辅助决策的应用2. 需求分析   * 角色与相关需求     * 初始参数管理员       1. 可以通过系统，简单的创建参数数据模型，包含数据模型中各基本参数的定义与解释以及数据模型的结构       2. 可以通过系统，简单的管理不同版本（不同初始参数，不同数据模型结构）的参数数据模型，包含增删改查，以及对参数模型的归类     * 模拟运行操作员       1. 可以通过系统，简单的获取不同类的参数模型集       2. 可以通过系统，简单的依照要求放入参数模型集，并启动模拟运行       3. 可以通过系统，简单的了解运行状况，运行进度，与报错日志     * 数据结果管理员       1. 可以通过系统，简单的获取数据模型结果集       2. 可以通过系统，查看可视化的运行结果       3. 可以通过系统，简单的对数据模型结果集进行进一步分类       4. 可以通过系统，简单的获取经过分类的数据模型结果中或者之间的各种比对信息     * 大模型管理员（功能选做：如果大模型作答内容质量低，则变为必做）       1. 可以通过系统，对模型进行调优，包含（RAG与大模型微调）       2. 可以通过系统，切换使用大模型（选做：如果项目其他内容完成，可以考虑完成）3. 实现方案设计   1. 方案一      * 具体内容：每一个时间片上，每一辆车分别计算最优路经，得到整体的交通网图      * 优势：可以溯源每一辆车的行为路径，得到的交通网图相对更加真实有效      * 劣势：车辆的移动计算十分麻烦，各种参数的传入比较苦难      * 不选择的原因：存储结构难以抉择，数据量提升后效率明显降低      * 未来扩展的可能性：在方案二完成后，可以考虑作为扩展功能   2. 方案二      * 具体内容：每一个时间片上，整体的道路情况交代，通过时空扩散模型得到未来情况      * 优势：可以轻易的通过较为简单的参数获得未来一定时间段的车流总体情况，可以体现特殊事件的影响      * 劣势：由于时空扩散模型具有随机性，以及大模型幻觉，获得的结果可能不够准确      * 选择的原因：实现难度相对更低，其次不够准确的问题，可以通过增加评估模块用奖励惩罚机制获得更好的结果4. 系统架构   1. 系统框架图      ![图片](img/2025-06-29_144457.png)     2. 各子系统简介      1. 前端展示部分：辅助用户可视化的使用系统相关功能，呈现系统操作界面与结果展示界面      2. 前端后端交互部分：桥接前端后端的内容交互与传输，成为显示与业务逻辑的纽带      3. 业务逻辑处理部分：实现核心业务代码，完成数据的处理与返回      4. 本地存储部分：存储运行结果，运行参数以及运行的初始参数，将内容长期存储与本地      5. 系统部署层：实现源代码的落地，使用   3. 给功能模块介绍      1. 同步页面访问：完成同步页面的切换，实现大功能的页面访问      2. 异步页面访问：完成异步页面的刷新，实现局部功能的访问      3. 路由管理：处理url，分派任务      4. 视图处理：请求需要的数据，并返回可视化的信息      5. 管理平台：管理初始参数文件，管理结果文件以及分析文件，实现CRUD以及分类      6. 人工智能体：实现云端访问，完成数据的分析，与输出验证      7. 结果与参数文件存储：实现本地长期存储与格式要求和分类存储      8. 本地部署：实现简单的单机实地运行      9. 服务器部署接口留存：预留未来服务器部署扩展接口，方便项目的线上运行5. 子功能模块设计   1. 各功能模块子模块设计      * 本地参数文件管理模块        * 作用：管理本地参数文件        * 功能描述          * 管理系统初始化参数          * 管理交通网图车辆初始信息        * 内容设计          * 需要实现的api            * ParamDocManager              * doc_name_generator: 生成参数集文件夹，并进行命名                * 文件夹命名规范：{用户给出的名字}_param_doc                * 文件夹命名要求：都为英文小写字母，不得重复              * load_title_structure_doc: 加载参数集头文件模板 -> json                * 参数集头文件格式                  * 大模型获得的交通网图模拟使用的数据结构说明                    * 键：data_structure                    * 值：数据结构的基本说明，即如何解析化为城市交通网图 -> str                  * 大模型获得的交通网图数据结构中使用的元素参数解析                    * 键：交通网图中使用的元素                    * 值：代表的含义 -> str                  * 大模型获得的交通网图模拟数据结构的若干示例及其说明                    * 键：traffic_simulation_example{数字}                      * 键：example                      * 值：一个交通网图模拟数据结构的示例 -> str                      * 键：illustrate                      * 值：对其的解释说明 -> str                  * 初始参数文件数量                    * 键：doc_param_num                    * 值：数量 -> int              * load_json_doc: 读取参数集头文件的初始参数文件数量，并加载初始参数模板 -> json                * 初始参数文件格式                  * 键：car_origin_info{car_id}                  * 值：车辆对象                  * 键：orign_traffic_info                  * 值：初始交通网图              * doc_json_generator: 生成参数集头文件/生成初始参数文件 -> json file                * 生成结果格式                  * 文件名：origin_param_title/origin_param{doc_param_num}              * doc_del: 删除指定的参数集文件夹              * doc_index: 查找到对应的参数集文件夹              * file_del: 删除指定的初始参数文件              * file_index: 查找指定的初始参数文件          * 抽象层             * BaseCar类：各类车辆的父类       * 结果数据文件管理模块         * 作用：管理本地结果文件         * 功能描述           * 管理结果文件以及结果分析文件           * 结果文件分类         * 内容设计           * 需要实现的api             * ReDocManager               * 方法                 * doc_name_generator: 生成主结果文件夹，并进行命名/生成副结果文件夹，并进行命名                   * 文件夹命名规范：{参数集文件夹中用户给出的名字}_re_doc/re_doc{doc_param_num}                   * 文件夹命名要求：都为英文小写字母，不得重复                 * load_title_structure_doc: 加载结果数据文件模板 -> json                   * 结果数据头文件格式                     * 使用的参数集                       * 键：param_set                       * 值：使用的参数集文件夹名 -> str                     * 结果车辆文件的数量                       * 键：re_car_num                       * 值：数量 -> int                     * 结果交通网图文件数量                       * 键：re_traffic_num                       * 值：数量 -> int                     * 结果分析文件数量                       * 键：re_analysis_num                       * 值：数量 -> int                     * 结果文件标签分类                       * 键：标签名                       * 值：结果文件名列表 -> list                 * load_json_doc: 读取结果数据头文件的结果文件数量，并加载结果文件模板 -> json                   * 结果文件格式1                     * 键：file_num                     * 值：数字 -> int                     * 键：car_id                     * 值：车辆id -> int                     * 键：车辆路径追踪                     * 值：路径追踪json串 -> json                   * 结果文件格式2                     * 键：file_num                     * 值：数字 -> int                      * 键：re_id                     * 值：交通网图 -> str                   * 结果文件格式3                     * 键：file_num                     * 值：数字 -> int                     * 键：analysis_file_list                     * 值：分析的文件名列表 -> list                     * 键：analysis_re                     * 值：分析结果 -> str                 * doc_json_generator: 生成结果数据头文件/生成结果车辆文件/生成结果交通网图文件/生成分析文件 -> json file                   * 生成结果格式                     * 文件名：re_title/re{re_car_num}/re{re_traffic_num}/re_analysis{re_analysis_num}                 * doc_del: 删除指定的结果文件夹                 * doc_index: 查找到对应的结果文件夹                 * file_del: 删除指定的结果文件                 * file_index: 查找指定的结果文件                 * add_tag: 增加标签                 * del_tag: 删除标签                 * add_file: 在指定标签中增加文件名                 * rm_file: 在指定标签中删除文件名                 * update_file: 更新文件内容信息      * 结果数据可视化模块        * 作用：可视化结果再现        * 功能描述          * 加载需可视化的基本数据          * 连结时空关系图        * 内容设计          * 需要实现的api            * load_traffic_metrics: 加载交通网图矩阵 -> metrics            * load_single_car_path: 加载单车路径追踪列表 -> list            * load_multiple_car_path: 加载多车路径追踪字典 -> dict            * zip_metrics: 得到连贯的交通网图 -> list          * 抽象层            * Metric类：所有矩阵的父类      * 结果数据分析模块        * 作用：获取结果分析        * 功能描述          * 获取动态模板          * 存储序列信息        * 内容设计          * 需要实现的api            * load_analyse_template: 加载需要分析内容模板 -> str            * get_analyse: 获取结果分析 -> json            * doc_analyse_generator: 生成结果文件 -> json file          * 抽象层              * Template: 各种模板父类            * LLM: 各种大模型父类      * 大模型切换模块        * 作用：大模型基本参数管理        * 功能描述          * 使用的大模型切换          * 大模型对象生成          * 管理外部api密钥          * 大模型的token最大数限制        * 内容设计          * 需要实现的api            * generator_llm_obj: 生成若干大模型对象            * switch_llm_obj: 切换使用的大模型对象          * 抽象层             * LLM: 各种大模型父类      * 大模型RAG模块（选做，暂不完成）        * 作用：        * 功能描述        * 内容设计          * 需要实现的api          * 抽象层        * 大模型微调模块（选做，暂不完成）        * 作用：        * 功能描述        * 内容设计          * 需要实现的api          * 抽象层      * prompt生成模块        * 作用：大模型提示词模板管理        * 功能描述          * 模板信息管理          * 动态模板生成        * 内容设计          * 需要实现的api            * load_data_structure_illustration_template: 加载关于数据结构基本信息的提示词模板            * load_orign_info: 加载初始参数            * load_traffic_template: 加载当前的交通网图信息的提示词模板            * load_pos_template: 加载当前需要进行判断车辆行进方向的起始位置与终止位置的提示词模板            * load_single_car_info_template: 加载单辆车的路径耗时信息模板            * load_traffic_density_template: 加载交通网图密集程度的信息模板            * zip_templates: 组合所有提示词          * 抽象层              * langchain模板相关抽象层      * llm交互模块        * 作用：大模型交互        * 功能描述          * 获取大模型反馈          * 动态更新结果信息文件        * 内容设计          * 需要实现的api            * get_final_template: 获取最终的模板            * chat_with_llm: 与大模型交互            * get_final_re: 获取最终大模型结果            * generator_final_re_doc: 生成最终结果文件夹及其相关文件            * update_re_doc: 更新文件夹内的相关文件            * get_re_doc: 获取指定文件夹的相关内容            * add_analyse_file: 增加分析文件            * simulation_global: 反复模拟所有时间的交通状况直到完成            * simulation_piece: 反复模拟单个时间片的交通状况直到完成          * 抽象层              * langchain模板相关抽象层      * 结果序列化模块        * 作用：结果标准化管理        * 功能描述          * 更新车辆路径          * 更新整体信息          * 更新分析信息        * 内容设计          * 需要实现的api            * update_single_car_path: 更新车辆路径追踪信息            * update_traffic: 更新交通网图信息            * get_analyse_info: 更新分析信息          * 抽象层             * langchain模板相关抽象层            * json相关抽象层      * 初始参数管理ui模块        * 作用：便捷地可视化管理初始参数文件        * 功能描述          * 可视化参数操作信息访问        * 内容设计          * 需要实现的api            * index_view: 显示主页            * seek_dir_view: 显示参数集查询页面            * seek_doc_view: 显示参数文件查询页面            * detail_view: 展示具体参数头文件信息以及初始参数文件信息页面            * add_dir_view: 显示增加新的参数集页面            * add_doc_view: 显示增加新的初始参数文件页面            * rm_dir_view: 删除参数集文件夹            * rm_doc_view: 删除初始参数文件            * input_cars_config: 显示加载上传车辆的初始配置信息页面            * input_traffic_img: 显示加载上传交通网图初始信息页面          * 抽象层              * BaseCar类：各类车辆的父类             * django相关抽象层      * 结果数据管理ui模块        * 作用：便捷地可视化管理结果数据文件        * 功能描述          * 可视化数据结果操作信息访问        * 内容设计          * 需要实现的api            * index_view: 显示主页            * seek_main_dir_view: 显示主结果数据文件夹查询页面            * seek_sub_dir_view: 显示副数据文件夹查询页面            * seek_doc_view: 显示结果文件查询页面            * detail_view: 展示具体结果数据头文件以及结果文件信息            * rm_dir_view: 删除结果数据文件夹            * rm_doc: 删除结果文件            * add_tag_view: 显示增加标签页面             * rm_tag: 删除标签            * add_file_view: 显示增加指定标签中的文件页面            * rm_file: 删除指定标签中的文件          * 抽象层             * django相关抽象层      * 结果数据分析ui模块        * 作用：便捷地可视化选择需要分析的文件组，并获得分析结果        * 功能描述          * 可视化数据结果分析信息生成展示        * 内容设计          * 需要实现的api            * index_show: 显示主页             * get_several_file_view: 显示选择分析文件组页面            * generator_analyse_view: 生成分析结果            * details_view: 显示结果生成页面          * 抽象层            * django相关抽象层      * 结果数据可视化模块        * 作用：可视化模拟运行结果，直观的了解交通状况        * 功能描述          * 可视化结果信息再现        * 内容设计          * 需要实现的api            * index_show: 显示主页            * get_dir_view: 显示选择指定主结果文件夹中的副结果文件夹页面             * simulation_func_view: 显示选择模拟生成车辆追踪页面            * simulation_view: 显示模拟生成可视化结果页面            * simulation_next_view: 显示下一个交通网图画面            * simulation_previous_view: 显示上一个交通网图画面            * simulation_in_a_row_view: 连续的勃发交通网图画面            * simulation_pop_view: 跳转至某一个交通网图画面          * 抽象层              * django相关抽象层      * 模拟生成信息可视化模块        * 作用：直观的进行模拟生成，并了解模拟生成状态        * 功能描述          * 可视化模拟生成过程        * 内容设计          * 需要实现的api            * index_view: 显示主页            * get_simulation_dir_view: 显示选择模拟生成初始参数集文件夹页面            * simulation_status_view: 显示模拟生成进度状态          * 抽象层              * django相关抽象层      * 大模型管理ui模块        * 作用：直观的进行大模型使用切换，并进行大模型微调与rag（暂不做）        * 功能描述          * 可视化管理使用大模型        * 内容设计          * 需要实现的api            * index_view: 显示主页            * switch_view: 显示切换页面            * seek_view: 显示可切换模型查询            * add_view: 显示增加模型页面            * del_view: 删除模型            * rag_view: rag页面            * fine_tuning_of_llm: 大模型微调          * 抽象层              * django相关抽象层      * 通用数据模型模块        * 作用：实现数据模型        * 功能描述          * 实现车辆信息的判断          * 实现网图的信息变化          * 实现矩阵的基本功能        * 内容设计          * 需要实现的api            * BaseCar              * 属性                * car_id: 车的id -> int                * car_start_pos: 车的起始位置 -> tuple                * car_end_pos: 车的终止位置 -> tuple                * car_current_pos: 车的当前时间片位置 -> tuple                * car_current_is_move: 车当前时间片是否移动 -> bool                * car_start_time: 车的出发时间 -> int              * 方法                * is_end: 判断车是否到达地点            * BaseTrafficImg              * 属性                * traffic_img: 交通网图                * car_img: 对应汽车分布坐标即当前时间片移动情况              * 方法                * search_can_move: 搜索可移动车辆                * clear_move: 复原车辆移动标志                * flush_car_img: 刷新车辆坐标图                * flush_traffic_img: 刷新交通网图            * Metrics              * 属性                * metric: 可以化为方阵              * 方法                * get_ele: 获取矩阵中的某一个值                * set_ele: 设置矩阵中的某一个值                * origin_set_metric: 初始化矩阵的值                * switch_metric_ele: 交换矩阵中的值            * LLM              * 属性                * api_base                * api_key                * model_name              * 方法                * generator_llm_obj: 返回大模型对象          * 抽象层            * BaseCar: 所有车类的父类            * BaseTrafficImg: 所有交通网图的父类            * Metrics: 所有矩阵的父类            * LLM: 所有大模型父类      * 通用方法模块           * 作用：完成部分通用方法        * 功能描述          * 实现文件的底层操作          * 实现基本验证类的底层操作        * 内容设计          * 需要实现的api            * create_dir: 创建文件夹            * create_file: 创建文件            * update_file: 更新文件            * rm_dir: 删除文件夹            * rm_file: 删除文件            * turn_to_python_type: 反序列化json串            * Validator              * 属性                * validator_elem: 需要验证的一个属性              * 方法                * single_elem_validator: 单一元素验证            * ValidatorSet              * 属性                * elem_list: Validator集合 -> list              * 方法                * validate_one_by_one: 依次进行单一验证                * validate_all: 整体验证          * 抽象层            * Validator: 所有单一验证的父类            * ValidatorSet: 所有集合验证的父类   2. 整体功能调用图      ![图片](img/2025-06-27_003852.png)  6. 技术架构设计   1. 技术栈罗列      * python语言：实现所有基础循环和类与方法构建      * django框架：实现前后端的桥接，并实现网页模板      * uWsgi：实现高效的并发处理      * ajax异步：实现舒适的网页刷新，提供更好地可视化效果      * langchain框架：实现便捷的提示词模板生成，大模型交互与大模型结果地验证与序列化      * 云服务器调用：实现强大地模型计算能力      * os库：实现与系统的交互      * json库：实现json格式文件的解析与生成      * git：实现版本管理与多人合作   2. 技术栈交互      * 前端的ajax获取用户的需求，通过uWsgi与Django框架来和后端沟通      * django的视图通过python语言后端，使用os库完成本地文件交互      * django的视图通过python语言后端，使用json库完成所需数据的解析      * django的视图通过python语言后端，获取大模型计算的结果      * python语言后端与langchain框架，生成提示词模版，间接的与大模型交互，并验证序列化大模型结果      * langchain框架通过与云服务器交互，直接地与大模型交流   3. 技术点列举和解决      1. 通用技术点         * 列表增删改查         * 前后端交互 | django框架         * 文件的CRUD | os库的使用         * 传输结构的封装与解析 | json库的使用         * 类的封装继承多态         * 字典操作         * 矩阵数据结构实现 | 嵌套列表，类的封装         * 前端内容验证技术 | 类的封装与方法调用         * 多人代码上传 | git      2. 关键技术点         * 大模型提示词动态生成技术 | langchain的template相关模块         * 大模型交互技术 | 云服务器的key与base调用         * 大模型结果检验技术 | langchain的pydantic相关模块         * 大模型结果序列化技术 | langchain的parse相关模块         * 大模型切换技术 | 大模型全局对象的更改与langchain对各种大模型的支持         * 网页可视化结果生成技术 | json格式内容的解析与网页css，js技术         * 异步刷新网页内容 | ajax技术   4. 技术架构图      ![图片](img/2025-06-27_015222.png)7. 业务流程设计<hr>